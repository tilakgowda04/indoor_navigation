<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EFS Indoor Navigation</title>
<style>
body { font-family: Arial, sans-serif; background: lightsteelblue; margin: 0; padding: 0; }
header { background: royalblue; color: white; padding: 20px; text-align: center; }
.main-container { display: flex; gap: 20px; padding: 20px; max-width: 1600px; margin: 0 auto; }
.left-panel { width: 350px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); height: fit-content; overflow: visible !important; position: relative; z-index: 1000; }
#map { position: relative; width: 1200px; height: 800px; background: url('images/floorplan.jpg') no-repeat center; background-size: contain; border: 3px solid royalblue; border-radius: 10px; flex: 1; }
.path-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

/* ✅ Path animation */
.curved-path {
  fill: none;
  stroke: red;
  stroke-width: 4;
  stroke-linecap: round;
  stroke-dasharray: 20, 12;
  animation: dashFlow 1.5s linear infinite;
}
@keyframes dashFlow {
  to { stroke-dashoffset: -32; }
}

/* ✅ Markers */
.marker {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid white;
  cursor: pointer;
  z-index: 10;
}

/* ✅ Labels beside markers (default) */
.marker-label {
  position: absolute;
  top: 50%;               
  left: 120%;             
  transform: translateY(-50%); 
  color: white;           /* text stays white */
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 12px;
  white-space: nowrap;
  pointer-events: none;
}

/* ✅ Special case → label below the dot */
.label-below {
  top: 120%;   /* below marker */
  left: 50%;   /* centered */
  transform: translateX(-50%);
}

.start-marker { background: green !important; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; }
.end-marker { background: red !important; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; }

#controls { margin-bottom: 20px; }
#controls h3 { color: royalblue; margin-bottom: 15px; border-bottom: 2px solid lightsteelblue; padding-bottom: 8px; }

label { font-size: 18px; font-weight: bold; color: royalblue; }
select { 
  width: 100%; 
  padding: 16px; 
  font-size: 20px; 
  font-weight: bold;  
  margin: 12px 0; 
  border-radius: 8px; 
  border: 2px solid royalblue; 
  box-sizing: border-box; 
  position: relative; 
  z-index: 2000; 
  background: white; 
}
select option { font-size: 20px; font-weight: bold; padding: 12px; }

button { width: 100%; padding: 12px; font-size: 16px; margin: 8px 0; border-radius: 6px; border: 2px solid royalblue; background: royalblue; color: white; cursor: pointer; font-weight: bold; }
button:hover { background: navy; }
button.clear-btn { background: crimson; border-color: crimson; }
button.clear-btn:hover { background: firebrick; }

/* Hide graph nodes, labels, and connection lines */
.node, .node-label, .graph-line { display: none !important; }
</style>
</head>
<body>  
 
<header> 
  <h2>EFS-First Floor Indoor Navigation</h2>
  <p>Select Start and Destination to get the shortest route</p>
</header>
 
<div class="main-container">   
  <div class="left-panel">
    <div id="controls">
      <h3>Navigation Controls</h3>
      <label for="startSelect"><strong>Start Location:</strong></label>
      <select id="startSelect"></select>
      
      <label for="destSelect"><strong>Destination:</strong></label>
      <select id="destSelect"></select>
      
      <button onclick="showPath()">Show Route</button>
      <button class="clear-btn" onclick="clearPath()">Clear Path</button>
    </div>
  </div>
 
  <div id="map">
    <!-- Path SVG for route + graph lines -->
    <svg class="path-svg" id="pathSvg"></svg>
    <svg class="path-svg" id="graphSvg"></svg>
  </div>
</div>

<script>
// Room coordinates
const coordinates = {
  "Transformation":[380,710],
  "Meeting Room4":[642,300],
  "Diversity":[485,275],
  "Printer1":[410,660],
  "Printer2":[685,215],
  "Women's Restroom":[640,540],
  "Men's Restroom":[560,370],
  "Left Stair1":[170,325],
  "Right Stair2":[660,380],
  "Lift":[420,450],
  " Service lift":[560,460],
  "Innovation":[400,280],
};

// ✅ Colors for markers + labels (matching floor sketch)
const colorMapping = {
  "Innovation": "#ff5722",      // orange
  "Diversity": "#3f51b5",       // blue
  "Meeting Room4": "#009688",   // teal
  "Transformation": "#8bc34a",  // green
  "Printer1": "#9e9e9e",        // grey
  "Printer2": "#9e9e9e",
  "Women's Restroom": "#e91e63", // pink
  "Men's Restroom": "#2196f3",   // light blue
  "Left Stair1": "#795548",      // brown
  "Right Stair2": "#795548",
  "Lift": "#673ab7",             // purple
  " Service lift": "#607d8b"     // dark grey-blue
};

// Corridor graph
const navGraph = {
  n1:{x:380,y:680,connections:['n2','n40']},n2:{x:348,y:680,connections:['n1','n3','n39','n23']},
  n3:{x:347,y:600,connections:['n2','n4','n36']},n4:{x:335,y:500,connections:['n3','n5']},
  n5:{x:335,y:423,connections:['n4','n6','n8']},n6:{x:345,y:345,connections:['n5','n7','n17']},
  n7:{x:260,y:330,connections:['n6','n39','n42']},n8:{x:420,y:423,connections:['n5','n9']},
  n9:{x:506,y:424,connections:['n8','n10','n37']},n10:{x:504,y:340,connections:['n9','n11']},
  n11:{x:560,y:340,connections:['n10','n12','n29','n15']},n12:{x:585,y:340,connections:['n11','n13']},
  n13:{x:585,y:220,connections:['n12','n14']},n14:{x:584,y:180,connections:['n13']},
  n15:{x:655,y:340,connections:['n11','n16']},n16:{x:680,y:340,connections:['n15','n28','n29']},
  n17:{x:350,y:250,connections:['n6','n18','n33','n34']},n18:{x:350,y:220,connections:['n17','n19']},
  n19:{x:351,y:180,connections:['n18','n20']},n20:{x:355,y:150,connections:['n19','n21']},
  n21:{x:360,y:110,connections:['n20','n43']},n22:{x:505,y:670,connections:['n37','n40','n25']},
  n23:{x:150,y:680,connections:['n2']},n24:{x:600,y:660,connections:['n25','n41']},
  n25:{x:550,y:660,connections:['n24','n22']},n26:{x:675,y:175,connections:['n27']},
  n27:{x:675,y:220,connections:['n26','n28']},n28:{x:678,y:260,connections:['n27','n16','n29']},
  n29:{x:685,y:340,connections:['n28','n11','n30','n16']},n30:{x:755,y:340,connections:['n29','n31']},
  n31:{x:762,y:420,connections:['n30']},n32:{x:490,y:250,connections:['n33']},
  n33:{x:430,y:252,connections:['n32','n17']},n34:{x:402,y:250,connections:['n17']},
  n35:{x:160,y:600,connections:['n36']},n36:{x:300,y:600,connections:['n35','n3']},
  n37:{x:502,y:570,connections:['n38','n22','n9']},n38:{x:643,y:570,connections:['n37']},
  n39:{x:255,y:680,connections:['n2']},n40:{x:470,y:680,connections:['n1','n22']},
  n41:{x:690,y:660,connections:['n24']},n42:{x:265,y:200,connections:['n7']},
  n43:{x:470,y:80,connections:['n21']}
};

// Distance function
function dist(a,b){ return Math.hypot(navGraph[a].x-navGraph[b].x, navGraph[a].y-navGraph[b].y); }

// A* algorithm
function aStar(start,goal){
  let open=[start],came={},g={},f={};
  Object.keys(navGraph).forEach(n=>{g[n]=Infinity;f[n]=Infinity;});
  g[start]=0;f[start]=dist(start,goal);
  while(open.length>0){
    let current=open.reduce((a,b)=>f[a]<f[b]?a:b);
    if(current===goal){
      let path=[current];while(current in came){current=came[current];path.unshift(current);}
      return path;
    }
    open=open.filter(n=>n!==current);
    for(let neighbor of navGraph[current].connections){
      let tg=g[current]+dist(current,neighbor);
      if(tg<g[neighbor]){
        came[neighbor]=current;g[neighbor]=tg;f[neighbor]=tg+dist(neighbor,goal);
        if(!open.includes(neighbor))open.push(neighbor);
      }
    }
  }
  return [];
}

const mapDiv=document.getElementById("map");
const pathSvg=document.getElementById("pathSvg");
const graphSvg=document.getElementById("graphSvg");

// ✅ Room markers with labels (dot + matching label color)
Object.keys(coordinates).forEach(loc => {
  const [x, y] = coordinates[loc];
  const wrapper = document.createElement("div");
  wrapper.style.position = "absolute";
  wrapper.style.left = (x - 8) + "px";
  wrapper.style.top = (y - 8) + "px";

  const marker = document.createElement("div");
  marker.className = "marker";
  const color = colorMapping[loc] || "mediumturquoise";
  marker.style.background = color;

  const label = document.createElement("div");
  label.className = "marker-label";
  label.textContent = loc;
  label.style.background = color; // ✅ label matches marker color
  label.style.color = "white";

  if (loc === "Men's Restroom") {
    label.classList.add("label-below");
  }

  wrapper.appendChild(marker);
  wrapper.appendChild(label);
  mapDiv.appendChild(wrapper);
});

// Dropdowns
const startSelect=document.getElementById("startSelect");
const destSelect=document.getElementById("destSelect");

// ✅ Allowed start locations
const startMapping = {
  "Meeting Room": "Meeting Room4",
  "Transformation": "Transformation",
  "Diversity": "Diversity",
  "Innovation": "Innovation"
};
Object.keys(startMapping).forEach(label=>{
  let option=document.createElement("option");
  option.value=label; option.text=label;
  startSelect.appendChild(option);
});

// Destination dropdown → all rooms
Object.keys(coordinates).forEach(loc=>{
  let option=document.createElement("option");
  option.value=loc; option.text=loc;    
  destSelect.appendChild(option);
});

// Find nearest corridor node
function nearestNode([x,y]){
  let nearest=null,minDist=Infinity;
  Object.keys(navGraph).forEach(nodeId=>{
    let d=Math.hypot(navGraph[nodeId].x-x,navGraph[nodeId].y-y);
    if(d<minDist){minDist=d;nearest=nodeId;}
  });
  return nearest;
}

// Show path
function showPath(){
  clearPath();
  const startLabel=startSelect.value,dest=destSelect.value;
  if(!startLabel||!dest||startLabel===dest){alert("Select different start and destination.");return;}
  const start=startMapping[startLabel];
  const startNode=nearestNode(coordinates[start]),destNode=nearestNode(coordinates[dest]);
  const corridorPath=aStar(startNode,destNode);
  if(corridorPath.length===0){alert("No path found.");return;}

  let fullPath=[{x:coordinates[start][0],y:coordinates[start][1]},...corridorPath.map(n=>navGraph[n]),{x:coordinates[dest][0],y:coordinates[dest][1]}];

  let d=`M ${fullPath[0].x},${fullPath[0].y}`;
  for(let i=1;i<fullPath.length;i++){ d+=` L ${fullPath[i].x},${fullPath[i].y}`; }

  let path=document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d",d);
  path.setAttribute("class","curved-path");
  pathSvg.appendChild(path);

  let sm=document.createElement("div");sm.className="marker start-marker";sm.style.left=(coordinates[start][0]-10)+"px";sm.style.top=(coordinates[start][1]-10)+"px";mapDiv.appendChild(sm);
  let em=document.createElement("div");em.className="marker end-marker";em.style.left=(coordinates[dest][0]-10)+"px";em.style.top=(coordinates[dest][1]-10)+"px";mapDiv.appendChild(em);
}

// Clear path
function clearPath(){
  document.querySelectorAll(".curved-path,.start-marker,.end-marker").forEach(e=>e.remove());
}
</script>
</body>
</html>
